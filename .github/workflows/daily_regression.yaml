name: daily_regression

on:
  schedule:
    # * is a special character in YAML so you have to quote this string
    - cron:  '0 0 * * *'

concurrency:
  group: ${{ github.workflow }}-${{ github.ref }}
  cancel-in-progress: true

jobs:
  unittest:
    # The type of runner that the job will run on
    runs-on: [modelscope-self-hosted-us]
    steps:
      - name: ResetFileMode
        shell: bash
        run: |
          # reset filemode to allow action runner to delete files
          # generated by root in docker
          set -e
          source ~/.bashrc
          sudo chown -R $USER:$USER  $ACTION_RUNNER_DIR

      - name: Checkout
        uses: actions/checkout@v4
        with:
            lfs: false
            submodules: true
            fetch-depth: 0

      - name: Fetch LFS objects
        run: |
          git lfs pull

      - name: Run unittest
        shell: bash
        run: |
          set -e
          source /mnt/modelscope/regression_env.sh
          bash .dev_scripts/dockerci.sh
